<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CSOP Debug Test</title>
    <style>
        body {
            font-family: monospace;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #1a1a1a;
            color: #00ff00;
        }
        button {
            background: #00ff00;
            color: black;
            border: none;
            padding: 15px 30px;
            font-size: 18px;
            cursor: pointer;
            margin: 10px 5px;
            font-family: monospace;
            font-weight: bold;
        }
        button:hover {
            background: #00cc00;
        }
        #log {
            background: #000;
            padding: 20px;
            margin-top: 20px;
            border: 2px solid #00ff00;
            min-height: 200px;
            max-height: 400px;
            overflow-y: auto;
        }
        .log-entry {
            margin: 5px 0;
            padding: 5px;
        }
        .success { color: #00ff00; }
        .error { color: #ff0000; }
        .info { color: #00aaff; }
        .warning { color: #ffaa00; }
    </style>
</head>
<body>
    <h1>üîß CSOP Debug Console</h1>
    <p>This will help us find the problem</p>
    
    <div>
        <button onclick="test1()">Test 1: Button Works?</button>
        <button onclick="test2()">Test 2: Module Loads?</button>
        <button onclick="test3()">Test 3: CSOP Exists?</button>
        <button onclick="test4()">Test 4: Full Test</button>
        <button onclick="clearLog()">Clear Log</button>
    </div>

    <div id="log"></div>

    <script>
        // Logger function
        function log(message, type = 'info') {
            const logDiv = document.getElementById('log');
            const entry = document.createElement('div');
            entry.className = `log-entry ${type}`;
            entry.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            logDiv.appendChild(entry);
            logDiv.scrollTop = logDiv.scrollHeight;
            console.log(`[${type.toUpperCase()}]`, message);
        }

        function clearLog() {
            document.getElementById('log').innerHTML = '';
        }

        // Test 1: Basic button click
        window.test1 = function() {
            log('‚úÖ Test 1 PASSED: Button click works!', 'success');
            alert('‚úÖ Button works!');
        }

        log('üîß Page loaded. Click Test 1 to verify buttons work.', 'info');
    </script>

    <script type="module">
        log('üì¶ Module script started...', 'info');

        // Test 2: Module loading
        window.test2 = function() {
            log('‚úÖ Test 2 PASSED: ES Modules work!', 'success');
            alert('‚úÖ ES Modules work!');
        }

        log('‚úÖ ES Module loaded successfully', 'success');

        // Test 3: Try to import CSOP
        let CSOP_CLASS = null;
        let csopInstance = null;

        (async function loadCSOP() {
            try {
                log('üåê Attempting to import CSOP from CDN...', 'info');
                log('üìç URL: https://cdn.jsdelivr.net/gh/Nexus-Studio-CEO/csop@v0.1.0/src/csop.js', 'info');
                
                const module = await import('https://cdn.jsdelivr.net/gh/Nexus-Studio-CEO/csop@v0.1.0/src/csop.js');
                
                log('‚úÖ CSOP module imported!', 'success');
                log(`üì¶ Module contains: ${Object.keys(module).join(', ')}`, 'info');
                
                CSOP_CLASS = module.CSOP || module.default;
                
                if (!CSOP_CLASS) {
                    throw new Error('CSOP class not found in module');
                }
                
                log('‚úÖ CSOP class extracted', 'success');
                
                // Test 3 is now ready
                window.test3 = function() {
                    log('‚úÖ Test 3 PASSED: CSOP class exists!', 'success');
                    log(`CSOP type: ${typeof CSOP_CLASS}`, 'info');
                    alert('‚úÖ CSOP class loaded!');
                }
                
                log('‚è≥ Initializing CSOP instance...', 'info');
                
                csopInstance = new CSOP_CLASS();
                log('‚úÖ CSOP instance created', 'success');
                
                await csopInstance.init();
                log('‚úÖ CSOP initialized!', 'success');
                log(`üìä CSOP info: ${JSON.stringify(csopInstance.info())}`, 'info');
                
                // Test 4 is now ready
                window.test4 = async function() {
                    try {
                        log('üß™ Running full CSOP test...', 'info');
                        
                        // Save test
                        log('üíæ Testing storage.save...', 'info');
                        const saveResult = await csopInstance.dispatch('storage.save', {
                            key: 'debug_test',
                            data: { 
                                test: true, 
                                timestamp: Date.now(),
                                message: 'Debug test successful!'
                            }
                        });
                        log(`‚úÖ Save result: ${JSON.stringify(saveResult.data)}`, 'success');
                        
                        // Get test
                        log('üì• Testing storage.get...', 'info');
                        const getResult = await csopInstance.dispatch('storage.get', {
                            key: 'debug_test'
                        });
                        log(`‚úÖ Get result: ${JSON.stringify(getResult.data)}`, 'success');
                        
                        log('üéâ Test 4 PASSED: Full CSOP test successful!', 'success');
                        alert(`‚úÖ Full test passed!\n\nData: ${JSON.stringify(getResult.data, null, 2)}`);
                        
                    } catch (error) {
                        log(`‚ùå Test 4 FAILED: ${error.message}`, 'error');
                        log(`Stack: ${error.stack}`, 'error');
                        alert(`‚ùå Test failed: ${error.message}`);
                    }
                }
                
                log('üéâ All systems ready! Click Test 4 for full test.', 'success');
                
            } catch (error) {
                log(`‚ùå CSOP Load Error: ${error.message}`, 'error');
                log(`Stack: ${error.stack}`, 'error');
                
                window.test3 = function() {
                    log('‚ùå Test 3 FAILED: CSOP not loaded', 'error');
                    alert(`‚ùå CSOP failed to load: ${error.message}`);
                }
                
                window.test4 = function() {
                    log('‚ùå Test 4 SKIPPED: CSOP not available', 'error');
                    alert('‚ùå CSOP not loaded. Check console for errors.');
                }
            }
        })();

        log('‚è≥ Loading CSOP in background...', 'info');
    </script>
</body>
</html>